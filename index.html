<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <title>Document</title>
    <style>

      *{
        box-sizing: border-box;
        margin: 0;
      }

      li{
        list-style: none;
        color: blanchedalmond;
      }
      .main{
        background-color: rgb(36, 151, 204);
        width: 100vw;
        height: 100rem;
        display: flex;
        justify-content: center;
      }
      button.btn.btn-danger {
        font-size: 8px;
      }
      
    </style>
  </head>
  <body>
    <div class="main">
      <div class="listinfor">
        <ul id="li-container">
          Bình luận phù hợp nhất    
        </ul>
  
        <div style="color: bisque;">
          User name: <input type="text" class="form-control" name="name">
        </div>
        <div style="color: bisque;">
          Comment: <input type="text" class="form-control" name="comment">
        </div>
        <div>
          <input type="button" value="Comment" class="btn btn-info" id="create">
        </div>
      </div>
    </div>
    <script>  
    //khai bao bien
      var getAPI = "http://localhost:3000/info";
      var localinfor =document.querySelector('#li-container');   




      function start() {   // khoi tao ham start
        getInfo(render)  //getInfo với tham so la gia tri cua ham render
        handleCreateForm()
      }


      start();//goi ham start


      function getInfo(callback) {
        fetch(getAPI)
          .then((data) => {
            return data.json();
          })
          .then(callback)
          .catch((error) => {
            return "Lỗi";
          });
      }

      function render(infors) {
        var htmls = infors.map((infor) => {
          return `  <li class="list-${infor.id}">
                        
                         ${infor.name}: ${infor.comment}
                        
                        <button class="btn btn-danger" onclick="Delete(${infor.id})">X</button>
                    </li>
                `
        });
        localinfor.innerHTML = htmls.join("");
      }






      function createCmt(data,callback){
        fetch(getAPI, {
          method: 'POST',
          headers: {
                    'Content-Type': 'application/json'
                  },
         body: JSON.stringify(data)
        })
        .then((data)=>{
          return data.json()
        })
        .then(callback)
      }






      function Delete(id){
        fetch(getAPI+"/"+id,{
          method: 'DELETE',
          headers: {
                    'Content-Type': 'application/json'
                  },
        })
        .then((data)=>{
          return data.json()
        })
        .then(()=>{
          var listid = document.querySelector(".list"+id);
          if(listid){
            listid.remove()
          }
        })
      }



      function handleCreateForm(){
        var createBtn = document.querySelector("#create");
        createBtn.onclick = ()=>{
          var name = document.querySelector('input[name="name"]').value
          var comment = document.querySelector('input[name="comment"]').value
          Data = {
            name:name,
            comment:comment,
          }
          createCmt(Data, ()=>{
            getInfo(render)  
          })
        } 
      }


    </script>
  </body>
</html>
